#!/bin/bash
#
# TapoCam Control Script
# Quick commands for managing the TapoCam service
#
SERVICE_NAME="tapocam"

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

case "$1" in
    start)
        echo "Starting TapoCam..."
        sudo systemctl start "$SERVICE_NAME"
        sleep 1
        systemctl status "$SERVICE_NAME" --no-pager
        ;;
    stop)
        echo "Stopping TapoCam..."
        sudo systemctl stop "$SERVICE_NAME"
        echo -e "${GREEN}Stopped${NC}"
        ;;
    restart)
        echo "Restarting TapoCam..."
        sudo systemctl restart "$SERVICE_NAME"
        sleep 1
        systemctl status "$SERVICE_NAME" --no-pager
        ;;
    status)
        systemctl status "$SERVICE_NAME" --no-pager
        ;;
    logs)
        sudo journalctl -u "$SERVICE_NAME" -f
        ;;
    logs-recent)
        sudo journalctl -u "$SERVICE_NAME" --since "1 hour ago" --no-pager
        ;;
    enable)
        sudo systemctl enable "$SERVICE_NAME"
        echo -e "${GREEN}Service enabled (will start on boot)${NC}"
        ;;
    disable)
        sudo systemctl disable "$SERVICE_NAME"
        echo -e "${YELLOW}Service disabled (won't start on boot)${NC}"
        ;;
    config)
        sudo nano /etc/tapocam/config.yaml
        ;;
    reload-config)
        echo "Reloading configuration via API..."
        curl -X POST http://localhost:8000/api/config/reload 2>/dev/null | python3 -m json.tool || echo -e "${RED}Failed to reload (is service running?)${NC}"
        ;;
    *)
        echo "TapoCam Control Script"
        echo
        echo "Usage: $0 {command}"
        echo
        echo "Commands:"
        echo "  start         Start the service"
        echo "  stop          Stop the service"
        echo "  restart       Restart the service"
        echo "  status        Show service status"
        echo "  logs          Follow service logs (live)"
        echo "  logs-recent   Show logs from last hour"
        echo "  enable        Enable autostart on boot"
        echo "  disable       Disable autostart on boot"
        echo "  config        Edit configuration file"
        echo "  reload-config Reload config without restart"
        exit 1
        ;;
esac
