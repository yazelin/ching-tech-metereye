# MeterEye Multi-Camera Configuration
# Copy this file to ~/.config/ctme/config.yaml

# Camera configurations
cameras:
  - id: cam-01
    name: "生產線 A"
    url: "${CAM01_RTSP_URL}"  # Set environment variable or replace with actual URL
    enabled: true
    processing_interval_seconds: 1.0  # How often to process frames (seconds). Higher = lower CPU usage
    meters:
      - id: meter-01
        name: "壓力表 1"
        perspective:
          points: [[100, 50], [300, 50], [300, 150], [100, 150]]  # TL, TR, BR, BL
          output_size: [400, 100]
        recognition:
          display_mode: light_on_dark  # or dark_on_light
          color_channel: red  # red, green, blue, gray
          threshold: 0  # 0 = auto (Otsu), 1-255 = manual

      - id: meter-02
        name: "壓力表 2"
        perspective:
          points: [[350, 50], [550, 50], [550, 150], [350, 150]]
          output_size: [400, 100]
        recognition:
          display_mode: light_on_dark
          color_channel: green
          threshold: 0

    # Indicator lights (alarm detection)
    indicators: []
    # Example:
    # indicators:
    #   - id: fire-alarm-01
    #     name: "西側PBL"
    #     perspective:
    #       points: [[100, 200], [200, 200], [200, 250], [100, 250]]
    #       output_size: [100, 50]
    #     detection:
    #       mode: brightness  # brightness or color
    #       threshold: 128    # 0 = auto (Otsu), 1-255 = manual
    #       on_color: red     # For color mode: red, green, blue, yellow, orange
    #     show_on_dashboard: true

  # Fire alarm panel example
  # - id: cam-fire
  #   name: "火災警報面板"
  #   url: "${CAM_FIRE_RTSP_URL}"
  #   enabled: true
  #   meters: []
  #   indicators:
  #     - id: fire-west-pbl
  #       name: "西側PBL"
  #       perspective:
  #         points: [[100, 50], [200, 50], [200, 100], [100, 100]]
  #         output_size: [100, 50]
  #       detection:
  #         mode: brightness
  #         threshold: 0  # auto
  #       show_on_dashboard: true
  #     - id: fire-east-pbl
  #       name: "東側PBL"
  #       perspective:
  #         points: [[250, 50], [350, 50], [350, 100], [250, 100]]
  #         output_size: [100, 50]
  #       detection:
  #         mode: color
  #         threshold: 128
  #         on_color: red
  #       show_on_dashboard: true

# Data export settings
export:
  # HTTP POST to external API
  http:
    enabled: false
    url: "http://host-pc:8080/api/readings"
    interval_seconds: 5
    batch_size: 10
    headers:
      Authorization: "Bearer ${API_TOKEN:-}"
    timeout_seconds: 10

  # Database storage
  database:
    enabled: false
    type: sqlite  # sqlite or postgresql
    path: "./readings.db"
    # PostgreSQL 連線範例 (使用 docker/docker-compose.yml):
    # connection_string: "postgresql+psycopg://metereye:metereye_secret@localhost:5433/metereye"
    retention_days: 30  # auto-delete old records

  # MQTT publish
  mqtt:
    enabled: false
    broker: "mqtt.local"
    port: 1883
    topic: "ctme/{camera_id}/{meter_id}"  # supports placeholders
    qos: 1
    username: ""
    password: ""

# REST API server
server:
  enabled: true
  host: "0.0.0.0"
  port: 8000
